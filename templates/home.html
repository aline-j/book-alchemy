<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Digital Library</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="top-bar">
        <h1>ðŸ“š Digital Library</h1>

        <div class="actions">
          <a href="/add_book" class="btn btn-primary">+ Add Book</a>
          <a href="/add_author" class="btn btn-secondary">+ Add Author</a>
        </div>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flash-container">
            {% for category, message in messages %}
              <div class="flash-message {{ category }}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- Search & Sort -->
      <div class="controls">
        <form method="GET" action="/">
          <input
            type="text"
            name="q"
            placeholder="Search books..."
            value="{{ keyword }}"
          />
        </form>

        <form method="GET">
          <select name="sort" onchange="this.form.submit()">
            <option value="title" {{ 'selected' if sort == 'title' else '' }}>
              Title
            </option>

            <option value="author" {{ 'selected' if sort == 'author' else '' }}>
              Author
            </option>
          </select>
        </form>
      </div>

      <!-- Book Cards -->
      <div class="book-grid">
        {% for book in books %}
        <div class="book-card">
          <div>
            <div class="cover-wrapper">
              <img
                class="book-cover"
                src="{{ book.cover_url }}"
                alt="Cover of {{ book.title }}"
              />
            </div>
            <h3>{{ book.title }}</h3>
            <div class="author">by {{ book.author.name }}</div>

            <div class="meta">
              {% if book.isbn %} ISBN: {{ book.isbn }}<br />
              {% endif %} {% if book.publication_year %} Year: {{
              book.publication_year }} {% endif %}
            </div>

            {% if book.rating %}
            <div class="rating">
              {% for i in range(book.rating) %}â˜…{% endfor %} {% for i in
              range(10 - book.rating) %}â˜†{% endfor %} ({{ book.rating }}/10)
            </div>
            {% endif %}
          </div>

          <div class="card-actions">
            <form
              action="{{ url_for('delete_book', book_id=book.id) }}"
              method="POST"
            >
              <button
                class="btn-danger"
                onclick="return confirm('Delete this book?');"
              >
                Delete Book
              </button>
            </form>

            <form
              action="{{ url_for('delete_author', author_id=book.author.id) }}"
              method="POST"
            >
              <button
                class="btn-gray"
                onclick="return confirm('Delete author and ALL books?');"
              >
                Delete Author
              </button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </body>
</html>
